name: Build Ultimate Spoofer

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v2
        
    - name: Add _CRT_SECURE_NO_WARNINGS to spoof_checker
      shell: powershell
      run: |
        Get-ChildItem "spoof_checker\*.cpp" | ForEach-Object {
          $content = Get-Content $_.FullName -Raw
          if ($content -notmatch '#define _CRT_SECURE_NO_WARNINGS') {
            $newContent = "#define _CRT_SECURE_NO_WARNINGS`r`n" + $content
            Set-Content $_.FullName $newContent
          }
        }
        Write-Host "Added _CRT_SECURE_NO_WARNINGS to spoof_checker files"
    
    - name: Build shellcode_builder
      shell: cmd
      run: |
        msbuild shellcode_builder\shellcode_builder.vcxproj /p:Configuration=Debug /p:Platform=x64 /p:PlatformToolset=v142 /p:TreatWarningAsError=false
        
    - name: Build wmic_block
      shell: cmd
      run: |
        msbuild wmic_block\wmic_block.vcxproj /p:Configuration=Debug /p:Platform=x64 /p:PlatformToolset=v142 /p:TreatWarningAsError=false
    
    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      if: success()
      with:
        name: ultimate-spoofer-partial-build
        path: |
          x64/Debug/*.exe
          x64/Debug/*.dll
